<?xml version="1.0" encoding="UTF-8"?>
<module name="huawei-bgp-l2vpnad"
        xmlns="urn:ietf:params:xml:ns:yang:yin:1"
        xmlns:bgp-l2vpnad="urn:huawei:yang:huawei-bgp-l2vpnad"
        xmlns:ext="urn:huawei:yang:huawei-extension"
        xmlns:ni="urn:huawei:yang:huawei-network-instance"
        xmlns:bgp="urn:huawei:yang:huawei-bgp"
        xmlns:rtp="urn:huawei:yang:huawei-routing-policy"
        xmlns:xpl="urn:huawei:yang:huawei-xpl"
        xmlns:bgp-rt="urn:huawei:yang:huawei-bgp-routing-table">
  <yang-version value="1"/>
  <namespace uri="urn:huawei:yang:huawei-bgp-l2vpnad"/>
  <prefix value="bgp-l2vpnad"/>
  <import module="huawei-extension">
    <prefix value="ext"/>
  </import>
  <import module="huawei-network-instance">
    <prefix value="ni"/>
  </import>
  <import module="huawei-bgp">
    <prefix value="bgp"/>
  </import>
  <import module="huawei-routing-policy">
    <prefix value="rtp"/>
  </import>
  <import module="huawei-xpl">
    <prefix value="xpl"/>
  </import>
  <import module="huawei-bgp-routing-table">
    <prefix value="bgp-rt"/>
  </import>
  <organization>
    <text>Huawei Technologies Co., Ltd.</text>
  </organization>
  <contact>
    <text>Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: http://www.huawei.com
Email: support@huawei.com</text>
  </contact>
  <description>
    <text>Inter-AS routing protocol that exchanges Network Layer Reachability Information (NLRI) with other BGP systems.</text>
  </description>
  <revision date="2020-08-30">
    <description>
      <text>The YANG descriptions are modified according to new standards.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <revision date="2019-03-22">
    <description>
      <text>Initial revision.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <grouping name="l2vpnad-cap-type">
    <description>
      <text>The l2vpnad-cap-type configuration.</text>
    </description>
    <leaf name="vpls-ad-disable">
      <type name="boolean"/>
      <default value="false"/>
      <description>
        <text>Enable/disable virtual private LAN service auto-discovery.not receive BGP-AD route.</text>
      </description>
    </leaf>
    <leaf name="vpws-enable">
      <type name="boolean"/>
      <default value="false"/>
      <description>
        <text>Enable/disable virtual private wire services.</text>
      </description>
    </leaf>
    <leaf name="vpls-enable">
      <type name="boolean"/>
      <default value="false"/>
      <description>
        <text>Enable/disable virtual private LAN services.</text>
      </description>
    </leaf>
  </grouping>
  <ext:task-name value="bgp"/>
  <augment target-node="/ni:network-instance/ni:instances/ni:instance/bgp:bgp/bgp:base-process/bgp:afs/bgp:af">
    <description>
      <text>BGP l2vpnad address family configuration.</text>
    </description>
    <container name="l2vpnad">
      <when condition="../bgp:type='l2vpnad'"/>
      <description>
        <text>Configure l2vpn-ad-family options.</text>
      </description>
      <container name="common">
        <description>
          <text>Configure l2vpn-ad-family common options.</text>
        </description>
        <uses name="bgp:vpn-target-type"/>
        <uses name="l2vpnad-cap-type"/>
        <leaf name="multi-homing-nonstand">
          <type name="boolean"/>
          <default value="false"/>
          <description>
            <text>Enable/disable capability of multi-homing for virtual private LAN services.</text>
          </description>
        </leaf>
        <leaf name="vpn-orf-enable">
          <type name="boolean"/>
          <default value="false"/>
          <description>
            <text>Enable/disable vpn-orf capability.</text>
          </description>
        </leaf>
        <leaf name="route-select-delay">
          <type name="uint16">
            <range value="0..3600"/>
          </type>
          <units name="s"/>
          <default value="0"/>
          <description>
            <text>Route selection delay.</text>
          </description>
        </leaf>
        <leaf name="reflect-change-path">
          <type name="boolean"/>
          <default value="false"/>
          <description>
            <text>Enable/disable an RR to use an export policy to change route AS_Path.</text>
          </description>
        </leaf>
        <leaf name="reflect-between-client">
          <type name="boolean"/>
          <default value="true"/>
          <description>
            <text>Enable/disable route reflection between clients. If clients of a route reflector (RR) are fully meshed, you can disable route reflection among clients to reduce the cost.</text>
          </description>
        </leaf>
        <uses name="bgp:reflector-cluster-type"/>
        <leaf name="default-local-preference">
          <type name="uint32">
            <range value="0..4294967295"/>
          </type>
          <default value="100"/>
          <description>
            <text>The local preference of BGP routes.</text>
          </description>
        </leaf>
        <uses name="bgp:bestroute-router-id-prior-clusterlist-type"/>
        <leaf name="tunnel-selector-name">
          <type name="leafref">
            <path value="/rtp:routing-policy/rtp:tunnel-selectors/rtp:tunnel-selector/rtp:name"/>
          </type>
          <description>
            <text>Configure a tunnel selector. Applying it to the BGP IPv4 unicast, BGP VPNv4 address families, BGP VPNv6 address families and BGP L2VPN AD address family so that IPv4,VPNv4,VPNv6 and L2VPN AD labeled routes can be iterated to tunnels based on the tunnel selector. By default, no tunnel selector is configured.</text>
          </description>
        </leaf>
        <uses name="bgp:route-reflector-ext-community-filter-type"/>
        <leaf name="nexthop-select-depend-type">
          <type name="bgp:select-depend-type"/>
          <default value="depend-ip"/>
          <description>
            <text>Specify the route iteration mode: IP or tunnel. In tunnel mode, the labeled BGP IPv4 route can participate in route selection only after its next hop is iterated to an LSP. In IP
mode, the labeled BGP IPv4 route can participate in route selection only after its next hop is iterated to an IP address. By default, the labeled BGP IPv4 route can participate in route selection
if its next hop can be iterated to an IP address, regardless of whether the LSP of the next hop exists. This allows the RR that is not enabled with MPLS to forward labeled routes. In non-RR
networking or RR networking where the BGP next hop is changed, BGP needs to check whether there is an LSP destined for the next hop. If such an LSP is not found, BGP needs to establish an LSP in
advance. If the default setting is adopted, a labeled BGP IPv4 unicast route may be selected prior to LSP establishment. As a result, services are incorrectly switched before LSP establishment and
service stability is affected. Therefore, allow route selection only after the labeled BGP IPv4 route is iterated to an LSP.</text>
          </description>
        </leaf>
      </container>
      <uses name="bgp:slow-peer-type"/>
    </container>
  </augment>
  <augment target-node="/ni:network-instance/ni:instances/ni:instance/bgp:bgp/bgp:base-process/bgp:peer-groups/bgp:peer-group/bgp:afs/bgp:af">
    <description>
      <text>BGP l2vpnad address family configuration.</text>
    </description>
    <container name="l2vpnad">
      <when condition="../bgp:type='l2vpnad'"/>
      <description>
        <text>Configure l2vpn-ad-family options.</text>
      </description>
      <leaf name="advertise-community">
        <type name="boolean"/>
        <default value="false"/>
        <description>
          <text>Enable/disable advertise the community attribute to a peer or a peer group.</text>
        </description>
      </leaf>
      <leaf name="reflect-client">
        <when condition="../../../../bgp:type='ibgp'"/>
        <type name="boolean"/>
        <default value="false"/>
        <description>
          <text>Enable/disable the local device as a route reflector (RR) and a peer or peer group as its client. This configuration is applicable between IBGP peers only. The configurations of RRs and its clients in an address family are valid only in this address family. Therefore, it is recommended to configure RRs and its clients in the specified address family that is required.</text>
        </description>
      </leaf>
      <leaf name="allow-as-loop">
        <type name="uint32">
          <range value="1..10"/>
        </type>
        <description>
          <text>Allow repetitive local AS numbers. By default, repetitive local AS numbers are not allowed.</text>
        </description>
      </leaf>
      <uses name="l2vpnad-cap-type"/>
      <leaf name="nexthop-configure">
        <type name="bgp:nexthop-configuration-type"/>
        <description>
          <text>Both the next-hop-local mode and next-hop-invariable mode are available when the peer address family is the VPNv4/VPNv6/L2VPN AD address family. Only the next-hop-local mode is available when the peer address family is not VPNv4/VPNV6/L2VPN AD address family. In next-hop-local mode, you can configure a BGP speaker to set its IP address of as the next hop of the routes to be advertised to IBGP peers or IBGP peer groups. In next-hop-invariable mode, you can configure PEs in different ASs not to change the next hop of routes when the PEs advertise the routes to their EBGP peers and use the next hop addresses of IGP routes to advertise imported IGP routes to IBGP peers. By default, when a BGP speaker advertises routes to EBGP peers and imported IGP routes to IBGP peers, the BGP speaker changes the next hop to its interface address.</text>
        </description>
      </leaf>
      <uses name="bgp:advertise-large-community-group-type"/>
      <choice name="import-policy-type">
        <description>
          <text>Set route policy or filter.</text>
        </description>
        <case name="rtp-ref">
          <description>
            <text>Route policy.</text>
          </description>
          <leaf name="import-policy">
            <type name="leafref">
              <path value="/rtp:routing-policy/rtp:policy-definitions/rtp:policy-definition/rtp:name"/>
            </type>
            <description>
              <text>Specify the filtering policy applied to the routes learned from a peer. By default, no such policy is specified.</text>
            </description>
          </leaf>
        </case>
        <case name="xpl-ref">
          <description>
            <text>Route filter.</text>
          </description>
          <container name="import-filter">
            <description>
              <text>Configure an import route-filter to filter the routes received from peers. By default, no route-filter is specified to filter the routes imported from peers.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/xpl:xpl/xpl:route-filters/xpl:route-filter/xpl:name"/>
              </type>
              <description>
                <text>Specify an import route-filter name.</text>
              </description>
            </leaf>
            <leaf name="parameter">
              <when condition="../name"/>
              <type name="xpl:filter-parameter-type"/>
              <description>
                <text>Specify an import route-filter parameter.</text>
              </description>
            </leaf>
          </container>
        </case>
      </choice>
      <choice name="export-policy-type">
        <description>
          <text>Set route policy or filter.</text>
        </description>
        <case name="rtp-ref">
          <description>
            <text>Route policy.</text>
          </description>
          <leaf name="export-policy">
            <type name="leafref">
              <path value="/rtp:routing-policy/rtp:policy-definitions/rtp:policy-definition/rtp:name"/>
            </type>
            <description>
              <text>Specify the filtering policy applied to the routes to be advertised to a peer. By default, no such policy is specified.</text>
            </description>
          </leaf>
        </case>
        <case name="xpl-ref">
          <description>
            <text>Route filter.</text>
          </description>
          <container name="export-filter">
            <description>
              <text>Configure an export route-filter to filter the routes to be advertised to peers. By default, no route-filter is specified to filter the routes to be advertised to peers.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/xpl:xpl/xpl:route-filters/xpl:route-filter/xpl:name"/>
              </type>
              <description>
                <text>Specify an export route-filter name.</text>
              </description>
            </leaf>
            <leaf name="parameter">
              <when condition="../name"/>
              <type name="xpl:filter-parameter-type"/>
              <description>
                <text>Specify an export route-filter parameter.</text>
              </description>
            </leaf>
          </container>
        </case>
      </choice>
      <uses name="bgp:rt-update-interval-type"/>
      <uses name="bgp:preferred-value-type"/>
      <uses name="bgp:group-independent-peer-group-type"/>
      <uses name="bgp:route-limit-type"/>
      <uses name="bgp:public-as-only-type"/>
      <uses name="bgp:group-public-as-only-import-type"/>
    </container>
  </augment>
  <augment target-node="/ni:network-instance/ni:instances/ni:instance/bgp:bgp/bgp:base-process/bgp:peers/bgp:peer/bgp:afs/bgp:af">
    <description>
      <text>BGP l2vpnad address family configuration.</text>
    </description>
    <container name="l2vpnad">
      <when condition="../bgp:type='l2vpnad'"/>
      <description>
        <text>Configure l2vpn-ad-family options.</text>
      </description>
      <leaf name="group-name">
        <type name="leafref">
          <path value="../../../../../../bgp:peer-groups/bgp:peer-group/bgp:name"/>
        </type>
        <must condition="../../../../../../bgp:peer-groups/bgp:peer-group[bgp:name = current()]/bgp:afs/bgp:af[bgp:type='l2vpnad']"/>
        <must condition="../../../../../../bgp:peer-groups/bgp:peer-group[bgp:name = current()]/bgp:peer-establish-mode = 'static'"/>
        <description>
          <text>Configure a name for a peer group. After a peer is deleted from the peer group, the peer is disabled from the address family. The object cannot be modified.</text>
        </description>
        <ext:operation-exclude value="update">
          <description>
            <text>The node cannot be modified, when the peer already belongs to a peer-group.</text>
          </description>
        </ext:operation-exclude>
      </leaf>
      <leaf name="advertise-community">
        <type name="boolean"/>
        <default value="false"/>
        <description>
          <text>Enable/disable advertise the community attribute to a peer or a peer group.</text>
        </description>
      </leaf>
      <leaf name="reflect-client">
        <type name="boolean"/>
        <default value="false"/>
        <description>
          <text>Enable/disable the local device as a route reflector (RR) and a peer or peer group as its client. This configuration is applicable between IBGP peers only. The configurations of RRs and its clients in an address family are valid only in this address family. Therefore, it is recommended to configure RRs and its clients in the specified address family that is required.</text>
        </description>
      </leaf>
      <leaf name="allow-as-loop">
        <type name="uint32">
          <range value="1..10"/>
        </type>
        <description>
          <text>Allow repetitive local AS numbers. By default, repetitive local AS numbers are not allowed.</text>
        </description>
      </leaf>
      <uses name="l2vpnad-cap-type"/>
      <leaf name="nexthop-configure">
        <type name="bgp:nexthop-configuration-type"/>
        <description>
          <text>Both the next-hop-local mode and next-hop-invariable mode are available when the peer address family is the VPNv4/VPNV6/L2VPN AD address family. Only the next-hop-local mode is available when the peer address family is not VPNv4/VPNV6/L2VPN AD address family. In next-hop-local mode, you can configure a BGP speaker to set its IP address of as the next hop of the routes to be advertised to IBGP peers or IBGP peer groups. In next-hop-invariable mode, you can configure PEs in different ASs not to change the next hop of routes when the PEs advertise the routes to their EBGP peers and use the next hop addresses of IGP routes to advertise imported IGP routes to IBGP peers. By default, when a BGP speaker advertises routes to EBGP peers and imported IGP routes to IBGP peers, the BGP speaker changes the next hop to its interface address.</text>
        </description>
      </leaf>
      <uses name="bgp:advertise-large-community-type"/>
      <choice name="import-policy-type">
        <description>
          <text>Set route policy or filter.</text>
        </description>
        <case name="rtp-ref">
          <description>
            <text>Route policy.</text>
          </description>
          <leaf name="import-policy">
            <type name="leafref">
              <path value="/rtp:routing-policy/rtp:policy-definitions/rtp:policy-definition/rtp:name"/>
            </type>
            <description>
              <text>Specify the filtering policy applied to the routes learned from a peer. By default, no such policy is specified.</text>
            </description>
          </leaf>
        </case>
        <case name="xpl-ref">
          <description>
            <text>Route filter.</text>
          </description>
          <container name="import-filter">
            <description>
              <text>Configure an import route-filter to filter the routes received from peers. By default, no route-filter is specified to filter the routes imported from peers.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/xpl:xpl/xpl:route-filters/xpl:route-filter/xpl:name"/>
              </type>
              <description>
                <text>Specify an import route-filter name.</text>
              </description>
            </leaf>
            <leaf name="parameter">
              <when condition="../name"/>
              <type name="xpl:filter-parameter-type"/>
              <description>
                <text>Specify an import route-filter parameter.</text>
              </description>
            </leaf>
          </container>
        </case>
      </choice>
      <choice name="export-policy-type">
        <description>
          <text>Set route policy or filter.</text>
        </description>
        <case name="rtp-ref">
          <description>
            <text>Route policy.</text>
          </description>
          <leaf name="export-policy">
            <type name="leafref">
              <path value="/rtp:routing-policy/rtp:policy-definitions/rtp:policy-definition/rtp:name"/>
            </type>
            <description>
              <text>Specify the filtering policy applied to the routes to be advertised to a peer. By default, no such policy is specified.</text>
            </description>
          </leaf>
        </case>
        <case name="xpl-ref">
          <description>
            <text>Route filter.</text>
          </description>
          <container name="export-filter">
            <description>
              <text>Configure an export route-filter to filter the routes to be advertised to peers. By default, no route-filter is specified to filter the routes to be advertised to peers.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/xpl:xpl/xpl:route-filters/xpl:route-filter/xpl:name"/>
              </type>
              <description>
                <text>Specify an export route-filter name.</text>
              </description>
            </leaf>
            <leaf name="parameter">
              <when condition="../name"/>
              <type name="xpl:filter-parameter-type"/>
              <description>
                <text>Specify an export route-filter parameter.</text>
              </description>
            </leaf>
          </container>
        </case>
      </choice>
      <uses name="bgp:rt-update-interval-type"/>
      <uses name="bgp:preferred-value-type"/>
      <uses name="bgp:peer-independent-peer-group-type"/>
      <uses name="bgp:route-limit-type"/>
      <uses name="bgp:public-as-only-type"/>
      <uses name="bgp:peer-public-as-only-import-type"/>
      <uses name="bgp:path-attr-map-type"/>
    </container>
  </augment>
  <augment target-node="/bgp:bgp/bgp:base-process/bgp-rt:bgp-route">
    <description>
      <text>BGP l2vpnad address family routes information.</text>
    </description>
    <container name="l2vpnad">
      <config value="false"/>
      <description>
        <text>Statistics of L2VPN AD routes.</text>
      </description>
      <container name="statistic">
        <description>
          <text>Statistics of BGP routes information of L2VPN AD address family.</text>
        </description>
        <uses name="bgp-rt:route-total-st-type"/>
      </container>
    </container>
  </augment>
</module>
