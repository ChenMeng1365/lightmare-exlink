<?xml version="1.0" encoding="UTF-8"?>
<module name="huawei-l3-multicast"
        xmlns="urn:ietf:params:xml:ns:yang:yin:1"
        xmlns:l3mc="urn:huawei:yang:huawei-l3-multicast"
        xmlns:ifm="urn:huawei:yang:huawei-ifm"
        xmlns:ni="urn:huawei:yang:huawei-network-instance"
        xmlns:l3vpn="urn:huawei:yang:huawei-l3vpn"
        xmlns:inet="urn:ietf:params:xml:ns:yang:ietf-inet-types"
        xmlns:ext="urn:huawei:yang:huawei-extension"
        xmlns:rt="urn:huawei:yang:huawei-routing"
        xmlns:ethernet="urn:huawei:yang:huawei-ethernet">
  <namespace uri="urn:huawei:yang:huawei-l3-multicast"/>
  <prefix value="l3mc"/>
  <import module="huawei-ifm">
    <prefix value="ifm"/>
  </import>
  <import module="huawei-network-instance">
    <prefix value="ni"/>
  </import>
  <import module="huawei-l3vpn">
    <prefix value="l3vpn"/>
  </import>
  <import module="ietf-inet-types">
    <prefix value="inet"/>
  </import>
  <import module="huawei-extension">
    <prefix value="ext"/>
  </import>
  <import module="huawei-routing">
    <prefix value="rt"/>
  </import>
  <import module="huawei-ethernet">
    <prefix value="ethernet"/>
  </import>
  <organization>
    <text>Huawei Technologies Co., Ltd.</text>
  </organization>
  <contact>
    <text>Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: http://www.huawei.com
Email: support@huawei.com</text>
  </contact>
  <description>
    <text>Multicast basic service package.</text>
  </description>
  <revision date="2019-03-30">
    <description>
      <text>Initial revision.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <ext:task-name value="mcast-base"/>
  <typedef name="load-splitting-type">
    <type name="enumeration">
      <enum name="none">
        <value value="0"/>
        <description>
          <text>Disable load splitting for multicast routes.</text>
        </description>
      </enum>
      <enum name="source">
        <value value="1"/>
        <description>
          <text>Specify the multicast source-based load splitting mode. This mode applies to a scenario in which multiple sources provide services for one group.</text>
        </description>
      </enum>
      <enum name="group">
        <value value="2"/>
        <description>
          <text>Specify the multicast group-based multicast load splitting mode. This mode applies to a scenario in which one source provides services for multiple groups.</text>
        </description>
      </enum>
      <enum name="source-group">
        <value value="3"/>
        <description>
          <text>Specify the multicast source-based and group-based load splitting mode. This mode applies to a scenario in which multiple sources provide services for multiple groups.</text>
        </description>
      </enum>
      <enum name="balance">
        <value value="4"/>
        <description>
          <text>Specify the stable-preferred load splitting. This mode enables a device to automatically adjust and balance entries on equal-cost routes when equal-cost routes are added or deleted, when multicast routing entries are deleted, or when load splitting weights are changed on interfaces. This mode applies to a scenario in which hosts frequently join or leave groups and automatic load splitting adjustment is required.</text>
        </description>
      </enum>
      <enum name="balance-ucmp">
        <value value="5"/>
        <description>
          <text>Specify the balance-ucmp load splitting.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Load splitting type.</text>
    </description>
  </typedef>
  <typedef name="limit-type">
    <type name="enumeration">
      <enum name="pim-sm-star-group">
        <value value="1"/>
        <description>
          <text>PIM-SM (*, g).</text>
        </description>
      </enum>
      <enum name="pim-sm-source-group">
        <value value="2"/>
        <description>
          <text>PIM-SM (s, g).</text>
        </description>
      </enum>
      <enum name="pim-dm-star-group">
        <value value="3"/>
        <description>
          <text>PIM-DM (*, g).</text>
        </description>
      </enum>
      <enum name="pim-dm-source-group">
        <value value="4"/>
        <description>
          <text>PIM-DM (s, g).</text>
        </description>
      </enum>
      <enum name="bidir-pim-star-group">
        <value value="5"/>
        <description>
          <text>BIDIRPIM (*, g).</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Limit type.</text>
    </description>
  </typedef>
  <container name="l3-multicast">
    <description>
      <text>Configure l3-multicast.</text>
    </description>
    <container name="ipv4">
      <description>
        <text>Configure IPv4.</text>
      </description>
      <container name="limits">
        <description>
          <text>List of multicast route limit.</text>
        </description>
        <list name="limit">
          <must condition="l3mc:upper-threshold&gt;l3mc:lower-threshold"/>
          <key value="type"/>
          <description>
            <text>Configure multicast route limit.</text>
          </description>
          <leaf name="type">
            <type name="limit-type"/>
            <description>
              <text>Limit type.</text>
            </description>
          </leaf>
          <leaf name="value">
            <type name="uint32">
              <range value="1..16384"/>
            </type>
            <mandatory value="true"/>
            <description>
              <text>Limit value.</text>
            </description>
          </leaf>
          <leaf name="upper-threshold">
            <type name="uint32">
              <range value="1..100"/>
            </type>
            <default value="80"/>
            <description>
              <text>Upper threshold.</text>
            </description>
          </leaf>
          <leaf name="lower-threshold">
            <type name="uint32">
              <range value="1..100"/>
            </type>
            <default value="70"/>
            <description>
              <text>Lower threshold.</text>
            </description>
          </leaf>
          <leaf name="current-count">
            <type name="uint32">
              <range value="0..4294967295"/>
            </type>
            <config value="false"/>
            <description>
              <text>Current entry count.</text>
            </description>
          </leaf>
        </list>
      </container>
    </container>
    <container name="ipv6">
      <description>
        <text>Configure IPv6.</text>
      </description>
      <container name="limits">
        <description>
          <text>List of multicast route limit.</text>
        </description>
        <list name="limit">
          <must condition="l3mc:upper-threshold&gt;l3mc:lower-threshold"/>
          <key value="type"/>
          <description>
            <text>Configure multicast route limit.</text>
          </description>
          <leaf name="type">
            <type name="limit-type"/>
            <description>
              <text>Limit type.</text>
            </description>
          </leaf>
          <leaf name="value">
            <type name="uint32">
              <range value="1..16384"/>
            </type>
            <mandatory value="true"/>
            <description>
              <text>Limit value.</text>
            </description>
          </leaf>
          <leaf name="upper-threshold">
            <type name="uint32">
              <range value="1..100"/>
            </type>
            <default value="80"/>
            <description>
              <text>Upper threshold.</text>
            </description>
          </leaf>
          <leaf name="lower-threshold">
            <type name="uint32">
              <range value="1..100"/>
            </type>
            <default value="70"/>
            <description>
              <text>Lower threshold.</text>
            </description>
          </leaf>
          <leaf name="current-count">
            <type name="uint32">
              <range value="0..4294967295"/>
            </type>
            <config value="false"/>
            <description>
              <text>Current entry count.</text>
            </description>
          </leaf>
        </list>
      </container>
    </container>
  </container>
  <augment target-node="/ni:network-instance/ni:instances/ni:instance">
    <description>
      <text>Add mcastbase configuration to the l3vpn module.</text>
    </description>
    <container name="multicast">
      <description>
        <text>Configure multicast in the instance.</text>
      </description>
      <container name="ipv4">
        <when condition="(../../ni:name='_public_' and ../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast']) or ../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast']/l3vpn:route-distinguisher or (../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast'] and /ni:network-instance/ni:global/ni:route-distinguisher-auto-ip)"/>
        <presence value="Create mcastbaseAf4."/>
        <description>
          <text>Enable/disable multicast in the instance.</text>
        </description>
        <container name="global">
          <description>
            <text>Configure global multicast configurations.</text>
          </description>
          <leaf name="longest-match">
            <type name="boolean"/>
            <default value="false"/>
            <description>
              <text>Enable/disable the function of selecting an RPF route based on the longest matching rule. By default, the route with the highest preference is selected as the RPF route.</text>
            </description>
          </leaf>
          <leaf name="load-splitting">
            <type name="load-splitting-type"/>
            <default value="none"/>
            <description>
              <text>Configure a multicast load splitting policy.</text>
            </description>
          </leaf>
          <leaf name="cpu-fwd-disable">
            <type name="boolean"/>
            <default value="false"/>
            <description>
              <text>Enable/disable CPU forwarding. By default, CPU forwarding is enabled.</text>
            </description>
          </leaf>
          <leaf name="recursive-lookup-local-mt-enable">
            <when condition="../../../../ni:name='_public_'"/>
            <type name="boolean"/>
            <default value="false"/>
            <description>
              <text>Enable/disable multicast recursive lookup local mt.</text>
            </description>
          </leaf>
        </container>
        <container name="interface-min-ttls">
          <description>
            <text>List of multicast interface minimum TTL.</text>
          </description>
          <list name="interface-min-ttl">
            <must condition="../../../../ni:name=/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name]/ifm:vrf-name"/>
            <must condition="not(/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name][ifm:type='Global-VE']/ethernet:ethernet/ethernet:l3-sub-interface/ethernet:dot1q-termination)"/>
            <must condition="not(/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name][ifm:type='Global-VE']/ethernet:ethernet/ethernet:l3-sub-interface/ethernet:qinq-termination)"/>
            <key value="name"/>
            <description>
              <text>Configure multicast interface minimum TTL.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <description>
                <text>Name of an interface.</text>
              </description>
            </leaf>
            <leaf name="minimum-ttl">
              <type name="uint32">
                <range value="1..255"/>
              </type>
              <default value="1"/>
              <description>
                <text>Specify the minimum TTL value for multicast packets to be forwarded on an interface.</text>
              </description>
            </leaf>
          </list>
        </container>
        <container name="interface-track-vrrps">
          <description>
            <text>List of multicast track VRRP.</text>
          </description>
          <list name="interface-track-vrrp">
            <must condition="../../../../ni:name=/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name]/ifm:vrf-name"/>
            <key value="name"/>
            <description>
              <text>Configure multicast track VRRP.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <description>
                <text>Name of an interface.</text>
              </description>
            </leaf>
            <leaf name="vrrp-id">
              <type name="uint8">
                <range value="1..255"/>
              </type>
              <mandatory value="true"/>
              <description>
                <text>VRRP ID.</text>
              </description>
            </leaf>
            <leaf name="is-admin">
              <type name="boolean"/>
              <default value="false"/>
              <description>
                <text>Enable/disable a device to track admin VRRP. The value false indicates that it tracks normal VRRP, The value true indicates that it tracks admin VRRP.</text>
              </description>
            </leaf>
            <leaf name="track-interface">
              <when condition="../is-admin='true'"/>
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <mandatory value="true"/>
              <description>
                <text>Name of the interface associated with the VRRP backup group.</text>
              </description>
            </leaf>
          </list>
        </container>
        <container name="interface-boundarys">
          <description>
            <text>List of multicast boundaries.</text>
          </description>
          <list name="interface-boundary">
            <must condition="../../../../ni:name=/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name]/ifm:vrf-name"/>
            <key value="name group-address mask-length"/>
            <description>
              <text>Configure multicast boundaries.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <description>
                <text>Name of an interface.</text>
              </description>
            </leaf>
            <leaf name="group-address">
              <type name="inet:ipv4-address-no-zone">
                <pattern value="(22[4-9]|23\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}"/>
              </type>
              <description>
                <text>Indicate a multicast group address. In IPv4, the value ranges from 224.0.0.0 to 239.255.255.255, in dotted decimal notation.</text>
              </description>
            </leaf>
            <leaf name="mask-length">
              <type name="uint32">
                <range value="4..32"/>
              </type>
              <description>
                <text>Specify the mask length of a multicast group address. In IPv4, the value ranges from 4 to 32.</text>
              </description>
            </leaf>
          </list>
        </container>
        <container name="rpf-multi-topology">
          <when condition="../../../ni:name='_public_'"/>
          <must condition="../../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast']/rt:routing/rt:routing-manage/rt:topologys/rt:topology[rt:name='multicast']"/>
          <presence value="Enable multicast services to run in a specified multicast topology instance."/>
          <description>
            <text>Enable/disable the multicast multi-topology function. By default, the multicast multi-topology function is disabled. Before enabling a multicast multi-topology, you must create it globally first.</text>
          </description>
          <container name="topology-rule-list">
            <description>
              <text>Configure multicast multi-topology rules. Advanced multicast multi-topology and base topology names are supported.</text>
            </description>
            <leaf-list name="name">
              <type name="leafref">
                <path value="../../../../../l3vpn:afs/l3vpn:af/rt:routing/rt:routing-manage/rt:topologys/rt:topology/rt:name"/>
              </type>
              <must condition="../../../../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast']/rt:routing/rt:routing-manage/rt:topologys/rt:topology[rt:name=current()]"/>
              <description>
                <text>Configure name of a multicast multi-topology. The value is a string of case-sensitive characters.</text>
              </description>
            </leaf-list>
          </container>
        </container>
        <container name="limits">
          <description>
            <text>List of multicast vrf route limit.</text>
          </description>
          <list name="limit">
            <must condition="not(../../../../ni:name='_public_')"/>
            <must condition="l3mc:upper-threshold&gt;l3mc:lower-threshold"/>
            <key value="type"/>
            <description>
              <text>Configure multicast vrf route limit.</text>
            </description>
            <leaf name="type">
              <type name="limit-type"/>
              <description>
                <text>Limit type.</text>
              </description>
            </leaf>
            <leaf name="value">
              <type name="uint32">
                <range value="1..16384"/>
              </type>
              <mandatory value="true"/>
              <description>
                <text>Limit value.</text>
              </description>
            </leaf>
            <leaf name="upper-threshold">
              <type name="uint32">
                <range value="1..100"/>
              </type>
              <default value="80"/>
              <description>
                <text>Upper threshold.</text>
              </description>
            </leaf>
            <leaf name="lower-threshold">
              <type name="uint32">
                <range value="1..100"/>
              </type>
              <default value="70"/>
              <description>
                <text>Lower threshold.</text>
              </description>
            </leaf>
            <leaf name="current-count">
              <type name="uint32">
                <range value="0..4294967295"/>
              </type>
              <config value="false"/>
              <description>
                <text>Current entry count.</text>
              </description>
            </leaf>
          </list>
        </container>
      </container>
      <container name="ipv6">
        <when condition="(../../ni:name='_public_' and ../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv6-unicast']) or ../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv6-unicast']/l3vpn:route-distinguisher or (../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv6-unicast'] and /ni:network-instance/ni:global/ni:route-distinguisher-auto-ip)"/>
        <presence value="Create mcastbase-af6."/>
        <description>
          <text>Enable/disable multicast IPv6 in the instance.</text>
        </description>
        <container name="global">
          <description>
            <text>Configure global IPv6 multicast configurations.</text>
          </description>
          <leaf name="load-splitting">
            <type name="load-splitting-type"/>
            <default value="none"/>
            <description>
              <text>Configure a multicast load splitting policy.</text>
            </description>
          </leaf>
          <leaf name="cpu-fwd-disable">
            <type name="boolean"/>
            <default value="false"/>
            <description>
              <text>Enable/disable CPU forwarding. By default, CPU forwarding is enabled.</text>
            </description>
          </leaf>
        </container>
        <container name="interface-min-ttls">
          <description>
            <text>List of multicast IPv6 interface minimum TTL.</text>
          </description>
          <list name="interface-min-ttl">
            <must condition="../../../../ni:name=/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name]/ifm:vrf-name"/>
            <must condition="not(/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name][ifm:type='Global-VE']/ethernet:ethernet/ethernet:l3-sub-interface/ethernet:dot1q-termination)"/>
            <must condition="not(/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name][ifm:type='Global-VE']/ethernet:ethernet/ethernet:l3-sub-interface/ethernet:qinq-termination)"/>
            <key value="name"/>
            <description>
              <text>Configure multicast IPv6 interface minimum TTL.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <description>
                <text>Name of an interface.</text>
              </description>
            </leaf>
            <leaf name="minimum-ttl">
              <type name="uint32">
                <range value="1..255"/>
              </type>
              <default value="1"/>
              <description>
                <text>Specify the minimum TTL value for multicast packets to be forwarded on an interface. The value is an integer ranging from 1 to 255. The default value is 1.</text>
              </description>
            </leaf>
          </list>
        </container>
        <container name="interface-boundarys">
          <description>
            <text>List of multicast IPv6 boundaries.</text>
          </description>
          <list name="interface-boundary">
            <must condition="../../../../ni:name=/ifm:ifm/ifm:interfaces/ifm:interface[ifm:name=current()/name]/ifm:vrf-name"/>
            <key value="name group-address mask-length"/>
            <description>
              <text>Configure multicast IPv6 boundaries.</text>
            </description>
            <leaf name="name">
              <type name="leafref">
                <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
              </type>
              <description>
                <text>Name of an interface.</text>
              </description>
            </leaf>
            <leaf name="group-address">
              <type name="inet:ipv6-address-no-zone">
                <pattern value="[Ff]{2}[0-9A-Fa-f]{2}.+"/>
              </type>
              <description>
                <text>Indicate a multicast group address. In IPv6, the value is in hexadecimal notation and in the format of FFxx:xxxx:xxxx::xxxx.</text>
              </description>
            </leaf>
            <leaf name="mask-length">
              <type name="uint32">
                <range value="8..128"/>
              </type>
              <description>
                <text>Specify the mask length of a multicast group address. In IPv6, the value ranges from 8 to 128.</text>
              </description>
            </leaf>
          </list>
        </container>
        <container name="rpf-multi-topology">
          <when condition="../../../ni:name='_public_'"/>
          <must condition="../../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv6-unicast']/rt:routing/rt:routing-manage/rt:topologys/rt:topology[rt:name='multicast']"/>
          <presence value="Enable multicast services to run in a specified multicast topology instance."/>
          <description>
            <text>Enable/disable the multicast multi-topology function. By default, the multicast multi-topology function is disabled. Before enabling a multicast multi-topology, you must create it globally first.</text>
          </description>
          <container name="topology-rule-list">
            <description>
              <text>Configure multicast multi-topology rules. Advanced multicast multi-topology and base topology names are supported.</text>
            </description>
            <leaf-list name="name">
              <type name="leafref">
                <path value="../../../../../l3vpn:afs/l3vpn:af/rt:routing/rt:routing-manage/rt:topologys/rt:topology/rt:name"/>
              </type>
              <must condition="../../../../../l3vpn:afs/l3vpn:af[l3vpn:type='ipv6-unicast']/rt:routing/rt:routing-manage/rt:topologys/rt:topology[rt:name=current()]"/>
              <description>
                <text>Configure name of a multicast multi-topology. The value is a string of case-sensitive characters.</text>
              </description>
            </leaf-list>
          </container>
        </container>
        <container name="limits">
          <description>
            <text>List of multicast vrf route limit.</text>
          </description>
          <list name="limit">
            <must condition="not(../../../../ni:name='_public_')"/>
            <must condition="l3mc:upper-threshold&gt;l3mc:lower-threshold"/>
            <key value="type"/>
            <description>
              <text>Configure multicast vrf route limit.</text>
            </description>
            <leaf name="type">
              <type name="limit-type"/>
              <description>
                <text>Limit type.</text>
              </description>
            </leaf>
            <leaf name="value">
              <type name="uint32">
                <range value="1..16384"/>
              </type>
              <mandatory value="true"/>
              <description>
                <text>Limit value.</text>
              </description>
            </leaf>
            <leaf name="upper-threshold">
              <type name="uint32">
                <range value="1..100"/>
              </type>
              <default value="80"/>
              <description>
                <text>Upper threshold.</text>
              </description>
            </leaf>
            <leaf name="lower-threshold">
              <type name="uint32">
                <range value="1..100"/>
              </type>
              <default value="70"/>
              <description>
                <text>Lower threshold.</text>
              </description>
            </leaf>
            <leaf name="current-count">
              <type name="uint32">
                <range value="0..4294967295"/>
              </type>
              <config value="false"/>
              <description>
                <text>Current entry count.</text>
              </description>
            </leaf>
          </list>
        </container>
      </container>
    </container>
  </augment>
</module>
