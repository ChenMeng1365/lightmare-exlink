<?xml version="1.0" encoding="UTF-8"?>
<module name="huawei-erps"
        xmlns="urn:ietf:params:xml:ns:yang:yin:1"
        xmlns:erps="urn:huawei:yang:huawei-erps"
        xmlns:ifm="urn:huawei:yang:huawei-ifm"
        xmlns:ethernet="urn:huawei:yang:huawei-ethernet"
        xmlns:y1731="urn:huawei:yang:huawei-y1731"
        xmlns:vlan="urn:huawei:yang:huawei-vlan"
        xmlns:pub-type="urn:huawei:yang:huawei-pub-type"
        xmlns:ext="urn:huawei:yang:huawei-extension"
        xmlns:l2pt="urn:huawei:yang:huawei-l2pt">
  <namespace uri="urn:huawei:yang:huawei-erps"/>
  <prefix value="erps"/>
  <import module="huawei-ifm">
    <prefix value="ifm"/>
  </import>
  <import module="huawei-ethernet">
    <prefix value="ethernet"/>
  </import>
  <import module="huawei-y1731">
    <prefix value="y1731"/>
  </import>
  <import module="huawei-vlan">
    <prefix value="vlan"/>
  </import>
  <import module="huawei-pub-type">
    <prefix value="pub-type"/>
  </import>
  <import module="huawei-extension">
    <prefix value="ext"/>
  </import>
  <import module="huawei-l2pt">
    <prefix value="l2pt"/>
  </import>
  <organization>
    <text>Huawei Technologies Co., Ltd.</text>
  </organization>
  <contact>
    <text>Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: http://www.huawei.com
Email: support@huawei.com</text>
  </contact>
  <description>
    <text>Ethernet ring protection switching.</text>
  </description>
  <revision date="2020-05-26">
    <description>
      <text>Initial revision.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <ext:task-name value="erps"/>
  <typedef name="erps-version">
    <type name="enumeration">
      <enum name="v1">
        <value value="1"/>
        <description>
          <text>ERPS ring version 1.</text>
        </description>
      </enum>
      <enum name="v2">
        <value value="2"/>
        <description>
          <text>ERPS ring version 2.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS version.</text>
    </description>
  </typedef>
  <typedef name="erps-ring-mode">
    <type name="enumeration">
      <enum name="major">
        <value value="0"/>
        <description>
          <text>ERPS major ring.</text>
        </description>
      </enum>
      <enum name="sub">
        <value value="1"/>
        <description>
          <text>ERPS sub-ring.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS ring mode.</text>
    </description>
  </typedef>
  <typedef name="erps-enable-state">
    <type name="enumeration">
      <enum name="disable">
        <value value="0"/>
        <description>
          <text>Disable.</text>
        </description>
      </enum>
      <enum name="enable">
        <value value="1"/>
        <description>
          <text>Enable.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS state.</text>
    </description>
  </typedef>
  <typedef name="erps-port-role">
    <type name="enumeration">
      <enum name="common">
        <value value="0"/>
        <description>
          <text>Common port.</text>
        </description>
      </enum>
      <enum name="neighbour">
        <value value="1"/>
        <description>
          <text>RPL neighbour port.</text>
        </description>
      </enum>
      <enum name="owner">
        <value value="2"/>
        <description>
          <text>RPL owner port.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS port role.</text>
    </description>
  </typedef>
  <typedef name="erps-port-status">
    <type name="enumeration">
      <enum name="unknown">
        <value value="0"/>
        <description>
          <text>Unknown type.</text>
        </description>
      </enum>
      <enum name="discarding">
        <value value="1"/>
        <description>
          <text>Discarding type.</text>
        </description>
      </enum>
      <enum name="forwarding">
        <value value="3"/>
        <description>
          <text>Forwarding type.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS port status.</text>
    </description>
  </typedef>
  <typedef name="erps-signal-status">
    <type name="enumeration">
      <enum name="unknown">
        <value value="0"/>
        <description>
          <text>Signal status is unknown.</text>
        </description>
      </enum>
      <enum name="failed">
        <value value="1"/>
        <description>
          <text>Signal status is failed.</text>
        </description>
      </enum>
      <enum name="non-failed">
        <value value="2"/>
        <description>
          <text>Signal status is non-failed.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS port signal status.</text>
    </description>
  </typedef>
  <typedef name="erps-machine-state">
    <type name="enumeration">
      <enum name="idle">
        <value value="0"/>
        <description>
          <text>Idle status.</text>
        </description>
      </enum>
      <enum name="protection">
        <value value="1"/>
        <description>
          <text>Protection status.</text>
        </description>
      </enum>
      <enum name="manualswitch">
        <value value="2"/>
        <description>
          <text>ManualSwitch status.</text>
        </description>
      </enum>
      <enum name="forcedswitch">
        <value value="3"/>
        <description>
          <text>ForcedSwitch status.</text>
        </description>
      </enum>
      <enum name="pending">
        <value value="4"/>
        <description>
          <text>Pending status.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS machine status.</text>
    </description>
  </typedef>
  <typedef name="erps-protect-switch-mode">
    <type name="enumeration">
      <enum name="forced">
        <value value="1"/>
        <description>
          <text>Forced switch mode.</text>
        </description>
      </enum>
      <enum name="manual">
        <value value="2"/>
        <description>
          <text>Manual switch mode.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>ERPS protect switch mode.</text>
    </description>
  </typedef>
  <container name="erps">
    <description>
      <text>Ethernet ring protection switching.</text>
    </description>
    <container name="rings">
      <description>
        <text>List of ERPS rings.</text>
      </description>
      <list name="ring">
        <must condition="count(/ifm:ifm/ifm:interfaces/ifm:interface/ethernet:ethernet/ethernet:main-interface/ethernet:l2-attribute/erps:erps-attribute/erps:rings/erps:ring[erps:id=current()/id])&lt;=2"/>
        <key value="id"/>
        <unique tag="control-vlan"/>
        <description>
          <text>Configure ERPS ring management.</text>
        </description>
        <leaf name="id">
          <type name="uint32">
            <range value="1..255"/>
          </type>
          <description>
            <text>ERPS ring ID.</text>
          </description>
        </leaf>
        <leaf name="description">
          <type name="string">
            <length value="1..80"/>
          </type>
          <description>
            <text>Description of an ERPS ring.</text>
          </description>
          <ext:dynamic-default/>
        </leaf>
        <leaf name="control-vlan">
          <type name="uint16">
            <range value="1..4094"/>
          </type>
          <ext:operation-exclude value="update|delete">
            <when condition="/ifm:ifm/ifm:interfaces/ifm:interface/ethernet:ethernet/ethernet:main-interface/ethernet:l2-attribute/erps:erps-attribute/erps:rings/erps:ring[erps:id=current()/../id] "/>
            <description>
              <text>The 'control-VLAN' cannot be updated or deleted, when a port is added to the ring.</text>
            </description>
          </ext:operation-exclude>
          <must condition="/vlan:vlan/vlan:vlans/vlan:vlan[vlan:id=current()]/vlan:mac-learning='disable'"/>
          <must condition="not (/ifm:ifm/ifm:interfaces/ifm:interface/ethernet:ethernet/ethernet:main-interface/ethernet:l2-attribute/l2pt:bpdu-tunnel[l2pt:vlan-id = current()])"/>
          <description>
            <text>Control VLAN ID.</text>
          </description>
        </leaf>
        <leaf name="protected-instance-list">
          <type name="pub-type:id-range">
            <ext:value-range value="0..4094"/>
            <pattern value="((409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])?(-(409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9]))?(,((409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])(-(409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9]))?))*)|((([\\+|\\-](409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9]))|([\\+|\\-]\\((409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])-(409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])\\)))?(,(([\\+|\\-](409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9]))|([\\+|\\-]\\((409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])-(409[0-4]|40[0-8][0-9]|[1-3][0-9]{3}|[1-9][0-9]{1,2}|[0-9])\\))))*)"/>
          </type>
          <ext:operation-exclude value="update|delete">
            <when condition="/ifm:ifm/ifm:interfaces/ifm:interface/ethernet:ethernet/ethernet:main-interface/ethernet:l2-attribute/erps:erps-attribute/erps:rings/erps:ring[erps:id=current()/../id] "/>
            <description>
              <text>The 'protected-instance-list' cannot be updated or deleted, when a port is added to the ring.</text>
            </description>
          </ext:operation-exclude>
          <description>
            <text>Protect instance ID of an ERPS ring.</text>
          </description>
        </leaf>
        <leaf name="wait-restore-timer">
          <type name="uint32">
            <range value="1..12"/>
          </type>
          <units name="min"/>
          <default value="5"/>
          <description>
            <text>Wait-to-restore time.</text>
          </description>
        </leaf>
        <leaf name="guard-timer">
          <type name="uint32">
            <range value="1..200"/>
          </type>
          <units name="cs"/>
          <default value="200"/>
          <description>
            <text>Guard time for blocking received RAPS packets.</text>
          </description>
        </leaf>
        <leaf name="holdoff-timer">
          <type name="uint32">
            <range value="0..100"/>
          </type>
          <units name="ds"/>
          <default value="0"/>
          <description>
            <text>Holdoff time.</text>
          </description>
        </leaf>
        <leaf name="raps-mel">
          <type name="uint32">
            <range value="0..7"/>
          </type>
          <default value="7"/>
          <description>
            <text>Maintenance entity group level for ring automatic protection switching.</text>
          </description>
        </leaf>
        <leaf name="version">
          <type name="erps-version"/>
          <default value="v1"/>
          <description>
            <text>Basic version of an ERPS ring.</text>
          </description>
        </leaf>
        <leaf name="tc-protection-interval">
          <type name="uint16">
            <range value="1..600"/>
          </type>
          <units name="s"/>
          <default value="2"/>
          <description>
            <text>Topology change notification interval.</text>
          </description>
        </leaf>
        <leaf name="tc-protection-threshold">
          <type name="uint16">
            <range value="1..255"/>
          </type>
          <default value="3"/>
          <description>
            <text>Topology change notification threshold.</text>
          </description>
        </leaf>
        <leaf name="revertive-enable">
          <type name="boolean"/>
          <must condition="../revertive-enable='true' or ../version='v2'"/>
          <default value="true"/>
          <description>
            <text>Enable/disable revertive status of an ERPS ring.</text>
          </description>
        </leaf>
        <leaf name="ring-role">
          <type name="erps-ring-mode"/>
          <must condition="../ring-role='major' or ../version='v2'"/>
          <default value="major"/>
          <description>
            <text>Role information of an ERPS ring.</text>
          </description>
        </leaf>
        <leaf name="virtual-channel-enable">
          <type name="boolean"/>
          <must condition="../virtual-channel-enable='false' or (../version='v2' and ../ring-role='sub')"/>
          <default value="false"/>
          <description>
            <text>Enable/disable status of a virtual channel.</text>
          </description>
        </leaf>
        <leaf name="tc-notify-ring">
          <type name="pub-type:id-range">
            <ext:value-range value="1..255"/>
            <pattern value="((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})?(-(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1}))?(,((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})(-(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1}))?))*)|((([\\+|\\-](25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1}))|([\\+|\\-]\\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})-(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})\\)))?(,(([\\+|\\-](25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1}))|([\\+|\\-]\\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})-(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]{0,1})\\))))*)"/>
          </type>
          <must condition="../version='v2'"/>
          <description>
            <text>Ring ID for TC notification.</text>
          </description>
        </leaf>
        <container name="runing-info">
          <config value="false"/>
          <description>
            <text>Statistics of ERPS running status.</text>
          </description>
          <leaf name="wtr-timer">
            <type name="uint32"/>
            <units name="s"/>
            <description>
              <text>Value of the actual Wtr running time.</text>
            </description>
          </leaf>
          <leaf name="guard-timer">
            <type name="uint32"/>
            <units name="10 ms"/>
            <description>
              <text>Value of the actual Guard running time.</text>
            </description>
          </leaf>
          <leaf name="holdoff-timer">
            <type name="uint32"/>
            <units name="100 ms"/>
            <description>
              <text>Value of the actual Holdoff running time.</text>
            </description>
          </leaf>
          <leaf name="ring-state">
            <type name="erps-machine-state"/>
            <description>
              <text>Ring running state.</text>
            </description>
          </leaf>
          <leaf name="topo-last-change-time">
            <type name="string">
              <length value="1..65"/>
            </type>
            <description>
              <text>Topo last change time.</text>
            </description>
          </leaf>
          <leaf name="fsport">
            <type name="string">
              <length value="1..151"/>
            </type>
            <description>
              <text>Forced switch port.</text>
            </description>
          </leaf>
          <leaf name="msport">
            <type name="string">
              <length value="1..151"/>
            </type>
            <description>
              <text>Manual switch port.</text>
            </description>
          </leaf>
          <leaf name="wtb-timer">
            <type name="uint32"/>
            <description>
              <text>Value of the WTB timer.</text>
            </description>
          </leaf>
        </container>
        <container name="erps-port-infos">
          <config value="false"/>
          <description>
            <text>List of interface in ERPS ring.</text>
          </description>
          <list name="erps-port-info">
            <key value="interface-name"/>
            <config value="false"/>
            <description>
              <text>Statistics of interface in ERPS ring.</text>
            </description>
            <leaf name="interface-name">
              <type name="pub-type:if-name"/>
              <description>
                <text>Interface name in ERPS ring.</text>
              </description>
            </leaf>
            <leaf name="port-status">
              <type name="erps-port-status"/>
              <description>
                <text>Discarding or forwarding of port status in ERPS ring.</text>
              </description>
            </leaf>
            <leaf name="signal-status">
              <type name="erps-signal-status"/>
              <description>
                <text>Whether the port signals on the ERPS ring are failed.</text>
              </description>
            </leaf>
            <container name="erps-statics">
              <config value="false"/>
              <description>
                <text>Statistics of sent and received ERPS PDUs on a port.</text>
              </description>
              <leaf name="rx-sf-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about R-APS (SF) messages.</text>
                </description>
              </leaf>
              <leaf name="tx-sf-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about R-APS (SF) messages.</text>
                </description>
              </leaf>
              <leaf name="rx-nr-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about R-APS (NR) messages.</text>
                </description>
              </leaf>
              <leaf name="tx-nr-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about R-APS (NR) messages.</text>
                </description>
              </leaf>
              <leaf name="rx-nrrb-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about R-APS (NR, RB) messages.</text>
                </description>
              </leaf>
              <leaf name="tx-nrrb-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about R-APS (NR, RB) messages.</text>
                </description>
              </leaf>
              <leaf name="rx-fs-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about R-APS (FS) messages.</text>
                </description>
              </leaf>
              <leaf name="tx-fs-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about R-APS (FS) messages.</text>
                </description>
              </leaf>
              <leaf name="rx-ms-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about R-APS (MS) messages.</text>
                </description>
              </leaf>
              <leaf name="tx-ms-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about R-APS (MS) messages.</text>
                </description>
              </leaf>
              <leaf name="rx-event-pkts">
                <type name="uint32"/>
                <description>
                  <text>Receive statistics about event messages.</text>
                </description>
              </leaf>
              <leaf name="tx-event-pkts">
                <type name="uint32"/>
                <description>
                  <text>Sent statistics about event messages.</text>
                </description>
              </leaf>
            </container>
          </list>
        </container>
      </list>
    </container>
  </container>
  <rpc name="protect-switch">
    <description>
      <text>Configure the port blocking mode for an ERPS port.</text>
    </description>
    <ext:node-ref value="/erps:erps/erps:rings/erps:ring"/>
    <input>
      <leaf name="if-name">
        <type name="leafref">
          <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
        </type>
        <mandatory value="true"/>
        <description>
          <text>Interface name.</text>
        </description>
      </leaf>
      <leaf name="ring-id">
        <type name="leafref">
          <path value="/erps:erps/erps:rings/erps:ring/erps:id"/>
        </type>
        <mandatory value="true"/>
        <description>
          <text>ERPS ring ID.</text>
        </description>
      </leaf>
      <leaf name="mode">
        <type name="erps-protect-switch-mode"/>
        <mandatory value="true"/>
        <description>
          <text>ERPS protect switch mode.</text>
        </description>
      </leaf>
    </input>
  </rpc>
  <augment target-node="/ifm:ifm/ifm:interfaces/ifm:interface/ethernet:ethernet/ethernet:main-interface/ethernet:l2-attribute">
    <description>
      <text>Configure ERPS attribute on layer 2 port.</text>
    </description>
    <container name="erps-attribute">
      <must condition="../ethernet:link-type='hybrid' or ../ethernet:link-type='trunk'"/>
      <description>
        <text>Configure ERPS attribute on layer 2 port.</text>
      </description>
      <container name="rings">
        <description>
          <text>List of ERPS layer 2 ports.</text>
        </description>
        <list name="ring">
          <ext:operation-exclude value="delete">
            <when condition="../../../../../../../admin-status='up'"/>
            <description>
              <text>The 'ring' cannot be deleted, when the port state is up.</text>
            </description>
          </ext:operation-exclude>
          <must condition="/erps:erps/erps:rings/erps:ring[erps:id = current()/id]/erps:control-vlan and /erps:erps/erps:rings/erps:ring[erps:id = current()/id]/erps:protected-instance-list"/>
          <key value="id"/>
          <max-elements value="2"/>
          <description>
            <text>Configure ERPS attribute on layer 2 port.</text>
          </description>
          <leaf name="id">
            <type name="leafref">
              <path value="/erps:erps/erps:rings/erps:ring/erps:id"/>
            </type>
            <description>
              <text>ERPS ring ID.</text>
            </description>
          </leaf>
          <leaf name="port-role">
            <type name="erps-port-role"/>
            <ext:operation-exclude value="update|delete">
              <when condition="../../../../../../../admin-status='up'"/>
              <description>
                <text>The 'port-role' cannot be updated or deleted, when the port state is up.</text>
              </description>
            </ext:operation-exclude>
            <must condition="not(../port-role='neighbour') or /erps:erps/erps:rings/erps:ring[erps:id = current()/../id]/erps:version='v2'"/>
            <default value="common"/>
            <description>
              <text>Role of an ERPS ring port.</text>
            </description>
          </leaf>
          <container name="cfm-tracks">
            <description>
              <text>List of Configure ERPS with Ethernet CFM.</text>
            </description>
            <list name="cfm-track">
              <key value="md-name ma-name mep-id rmep-id"/>
              <max-elements value="1"/>
              <description>
                <text>Configure ERPS with Ethernet CFM.</text>
              </description>
              <leaf name="md-name">
                <type name="leafref">
                  <path value="/y1731:y1731/y1731:global-enable/y1731:mds/y1731:md/y1731:name"/>
                </type>
                <description>
                  <text>Name of a maintenance domain.</text>
                </description>
              </leaf>
              <leaf name="ma-name">
                <type name="leafref">
                  <path value="/y1731:y1731/y1731:global-enable/y1731:mds/y1731:md/y1731:mas/y1731:ma/y1731:name"/>
                </type>
                <description>
                  <text>Name of a maintenance association.</text>
                </description>
              </leaf>
              <leaf name="mep-id">
                <type name="leafref">
                  <path value="/y1731:y1731/y1731:global-enable/y1731:mds/y1731:md/y1731:mas/y1731:ma/y1731:meps/y1731:mep/y1731:id"/>
                </type>
                <description>
                  <text>ID of a MEP.</text>
                </description>
              </leaf>
              <leaf name="rmep-id">
                <type name="leafref">
                  <path value="/y1731:y1731/y1731:global-enable/y1731:mds/y1731:md/y1731:mas/y1731:ma/y1731:rmeps/y1731:rmep/y1731:id"/>
                </type>
                <description>
                  <text>ID of a remote MEP.</text>
                </description>
              </leaf>
            </list>
          </container>
        </list>
      </container>
      <container name="notify-subif">
        <when condition="../rings/ring"/>
        <description>
          <text>Configure association between ERPS and sub-interfaces.</text>
        </description>
        <leaf name="notify-vpls">
          <type name="erps-enable-state"/>
          <default value="disable"/>
          <description>
            <text>Associate ERPS with sub-interface bound to the VSI.</text>
          </description>
        </leaf>
        <leaf name="notify-bd">
          <type name="erps-enable-state"/>
          <default value="disable"/>
          <description>
            <text>Associate ERPS with sub-interface bound to the BD.</text>
          </description>
        </leaf>
      </container>
    </container>
  </augment>
</module>
