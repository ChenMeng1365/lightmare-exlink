<?xml version="1.0" encoding="UTF-8"?>
<module name="huawei-soc-bras"
        xmlns="urn:ietf:params:xml:ns:yang:yin:1"
        xmlns:soc-bras="urn:huawei:yang:huawei-soc-bras"
        xmlns:bras-user-manage="urn:huawei:yang:huawei-bras-user-manage"
        xmlns:ext="urn:huawei:yang:huawei-extension">
  <yang-version value="1"/>
  <namespace uri="urn:huawei:yang:huawei-soc-bras"/>
  <prefix value="soc-bras"/>
  <import module="huawei-bras-user-manage">
    <prefix value="bras-user-manage"/>
  </import>
  <import module="huawei-extension">
    <prefix value="ext"/>
  </import>
  <organization>
    <text>Huawei Technologies Co., Ltd.</text>
  </organization>
  <contact>
    <text>Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: http://www.huawei.com
Email: support@huawei.com</text>
  </contact>
  <description>
    <text>Security operation center for bras.</text>
  </description>
  <revision date="2020-04-27">
    <description>
      <text>Initial revision.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <typedef name="board-type">
    <type name="enumeration">
      <enum name="mpu-or-sru">
        <value value="1"/>
        <description>
          <text>Main Processing Unit or Switch Router Unit.</text>
        </description>
      </enum>
      <enum name="lpu">
        <value value="2"/>
        <description>
          <text>Line Processing Unit.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>The board type of the device.</text>
    </description>
  </typedef>
  <ext:task-name value="soc"/>
  <typedef name="system-state-type">
    <type name="enumeration">
      <enum name="main-memory-usage">
        <value value="0"/>
        <description>
          <text>The memory usage of the MPU.</text>
        </description>
      </enum>
      <enum name="slot-memory-usage">
        <value value="1"/>
        <description>
          <text>The memory usage of the LPU.</text>
        </description>
      </enum>
      <enum name="main-cpu-usage">
        <value value="2"/>
        <description>
          <text>The CPU usage of the MPU.</text>
        </description>
      </enum>
      <enum name="slot-cpu-usage">
        <value value="3"/>
        <description>
          <text>The CPU usage of the LPU.</text>
        </description>
      </enum>
      <enum name="access-queue">
        <value value="4"/>
        <description>
          <text>The access queue usage.</text>
        </description>
      </enum>
      <enum name="ppp-cpcar-drop">
        <value value="5"/>
        <description>
          <text>The rate of PPP packets discarded by CAR when being sent to the CPU.</text>
        </description>
      </enum>
      <enum name="ppp-receive-queue">
        <value value="6"/>
        <description>
          <text>The usage of queues for receiving PPP packets.</text>
        </description>
      </enum>
      <enum name="pppoe-receive-queue">
        <value value="7"/>
        <description>
          <text>The usage of queues for receiving PPPOE packets.</text>
        </description>
      </enum>
      <enum name="l2tp-queue">
        <value value="8"/>
        <description>
          <text>The usage of L2TP queues.</text>
        </description>
      </enum>
      <enum name="dhcp-slot-queue">
        <value value="9"/>
        <description>
          <text>The usage of DHCP queues.</text>
        </description>
      </enum>
      <enum name="fes-queue">
        <value value="10"/>
        <description>
          <text>The usage of UM FES queues.</text>
        </description>
      </enum>
      <enum name="lns-cpcar-drop">
        <value value="11"/>
        <description>
          <text>The rate of LNS packets discarded by CAR when being sent to the CPU.</text>
        </description>
      </enum>
      <enum name="dhcp-server-queue">
        <value value="13"/>
        <description>
          <text>The usage of DHCP server queues.</text>
        </description>
      </enum>
      <enum name="dhcpv6-server-queue">
        <value value="14"/>
        <description>
          <text>The usage of DHCPv6 server queues.</text>
        </description>
      </enum>
      <enum name="eap-cpcar-drop">
        <value value="15"/>
        <description>
          <text>The rate at which EAP packets are discarded due to CAR when the packets are sent to the CPU.</text>
        </description>
      </enum>
      <enum name="https-cpu-usage">
        <value value="16"/>
        <description>
          <text>CPU usage threshold that triggers adjustment of the flow establishment rate in an HTTPS redirection scenario.</text>
        </description>
      </enum>
      <enum name="ipoe-keepalive-cpu-usage">
        <value value="17"/>
        <description>
          <text>CPU usage threshold that triggers adjustment of the flow establishment rate in an IPOE keepalive.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>The system status for adjusting the user access rate.</text>
    </description>
  </typedef>
  <augment target-node="/bras-user-manage:bras-user-manage/bras-user-manage:access-speed">
    <description>
      <text>Sets the access rate limitation.</text>
    </description>
    <container name="adjust-thresholds">
      <description>
        <text>List of configure the system status threshold for decreasing the user access rate and the threshold for restoring the user access rate.</text>
      </description>
      <list name="adjust-threshold">
        <ext:generated-by value="system"/>
        <ext:operation-exclude value="create"/>
        <must condition="alarm-percent &gt; resume-percent"/>
        <key value="system-state"/>
        <description>
          <text>Configure the system status threshold for decreasing the user access rate and the threshold for restoring the user access rate.</text>
        </description>
        <leaf name="system-state">
          <type name="system-state-type"/>
          <description>
            <text>Monitor Type.</text>
          </description>
        </leaf>
        <leaf name="alarm-percent">
          <type name="uint32">
            <range value="2..100"/>
          </type>
          <units name="%"/>
          <ext:dynamic-default>
            <ext:default-value value="85">
              <when condition="../system-state = 'main-memory-usage'"/>
              <description>
                <text>The default value is 85 when system-state is main-memory-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="85">
              <when condition="../system-state = 'slot-memory-usage'"/>
              <description>
                <text>The default value is 85 when system-state is slot-memory-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="90">
              <when condition="../system-state = 'main-cpu-usage'"/>
              <description>
                <text>The default value is 90 when system-state is main-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="85">
              <when condition="../system-state = 'slot-cpu-usage'"/>
              <description>
                <text>The default value is 85 when system-state is slot-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="4">
              <when condition="../system-state = 'access-queue'"/>
              <description>
                <text>The default value is 4 when system-state is access-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'ppp-cpcar-drop'"/>
              <description>
                <text>The default value is 2 when system-state is ppp-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'ppp-receive-queue'"/>
              <description>
                <text>The default value is 2 when system-state is ppp-receive-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'pppoe-receive-queue'"/>
              <description>
                <text>The default value is 2 when system-state is pppoe-receive-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="10">
              <when condition="../system-state = 'l2tp-queue'"/>
              <description>
                <text>The default value is 10 when system-state is l2tp-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="6">
              <when condition="../system-state = 'dhcp-slot-queue'"/>
              <description>
                <text>The default value is 6 when system-state is dhcp-slot-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="9">
              <when condition="../system-state = 'fes-queue'"/>
              <description>
                <text>The default value is 9 when system-state is fes-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'lns-cpcar-drop'"/>
              <description>
                <text>The default value is 2 when system-state is lns-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="5">
              <when condition="../system-state = 'dhcp-server-queue'"/>
              <description>
                <text>The default value is 5 when system-state is dhcp-server-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="5">
              <when condition="../system-state = 'dhcpv6-server-queue'"/>
              <description>
                <text>The default value is 5 when system-state is dhcpv6-server-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'eap-cpcar-drop'"/>
              <description>
                <text>The default value is 2 when system-state is eap-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="90">
              <when condition="../system-state = 'https-cpu-usage'"/>
              <description>
                <text>The default value is 90 when system-state is https-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="90">
              <when condition="../system-state = 'ipoe-keepalive-cpu-usage'"/>
              <description>
                <text>The default value is 90 when system-state is ipoe-keepalive-cpu-usage.</text>
              </description>
            </ext:default-value>
          </ext:dynamic-default>
          <description>
            <text>The threshold for decreasing the user access rate.</text>
          </description>
        </leaf>
        <leaf name="resume-percent">
          <type name="uint32">
            <range value="1..99"/>
          </type>
          <units name="%"/>
          <ext:dynamic-default>
            <ext:default-value value="83">
              <when condition="../system-state = 'main-memory-usage'"/>
              <description>
                <text>The default value is 83 when system-state is main-memory-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="75">
              <when condition="../system-state = 'slot-memory-usage'"/>
              <description>
                <text>The default value is 75 when system-state is slot-memory-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="85">
              <when condition="../system-state = 'main-cpu-usage'"/>
              <description>
                <text>The default value is 85 when system-state is main-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="84">
              <when condition="../system-state = 'slot-cpu-usage'"/>
              <description>
                <text>The default value is 84 when system-state is slot-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="2">
              <when condition="../system-state = 'access-queue'"/>
              <description>
                <text>The default value is 2 when system-state is access-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../system-state = 'ppp-cpcar-drop'"/>
              <description>
                <text>The default value is 1 when system-state is ppp-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../system-state = 'ppp-receive-queue'"/>
              <description>
                <text>The default value is 1 when system-state is ppp-receive-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../system-state = 'pppoe-receive-queue'"/>
              <description>
                <text>The default value is 1 when system-state is pppoe-receive-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="5">
              <when condition="../system-state = 'l2tp-queue'"/>
              <description>
                <text>The default value is 5 when system-state is l2tp-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="3">
              <when condition="../system-state = 'dhcp-slot-queue'"/>
              <description>
                <text>The default value is 3 when system-state is dhcp-slot-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="5">
              <when condition="../system-state = 'fes-queue'"/>
              <description>
                <text>The default value is 5 when system-state is fes-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../system-state = 'lns-cpcar-drop'"/>
              <description>
                <text>The default value is 1 when system-state is lns-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="3">
              <when condition="../system-state = 'dhcp-server-queue'"/>
              <description>
                <text>The default value is 3 when system-state is dhcp-server-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="3">
              <when condition="../system-state = 'dhcpv6-server-queue'"/>
              <description>
                <text>The default value is 3 when system-state is dhcpv6-server-queue.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../system-state = 'eap-cpcar-drop'"/>
              <description>
                <text>The default value is 1 when system-state is eap-cpcar-drop.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="85">
              <when condition="../system-state = 'https-cpu-usage'"/>
              <description>
                <text>The default value is 85 when system-state is https-cpu-usage.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="85">
              <when condition="../system-state = 'ipoe-keepalive-cpu-usage'"/>
              <description>
                <text>The default value is 85 when system-state is ipoe-keepalive-cpu-usage.</text>
              </description>
            </ext:default-value>
          </ext:dynamic-default>
          <description>
            <text>The threshold for restoring the user access rate.</text>
          </description>
        </leaf>
      </list>
    </container>
    <container name="adjust-cpcar-level">
      <description>
        <text>Configure a minimum adjustable threshold for CP-CAR and intervals for decreasing the CP-CAR value from the minimum adjustable threshold to extremely low threshold and for restoring the value to the minimum adjustable threshold.</text>
      </description>
      <leaf name="minimum-adjustable-threshold">
        <type name="uint32">
          <range value="2..20"/>
        </type>
        <default value="10"/>
        <description>
          <text>The minimum adjustable threshold for the CP-CAR value, in percentage.</text>
        </description>
      </leaf>
      <leaf name="decrease-interval">
        <type name="uint32">
          <range value="10..600"/>
        </type>
        <units name="s"/>
        <default value="10"/>
        <description>
          <text>The interval for decreasing the CP-CAR value from the minimum adjustable threshold to extremely low threshold (1%).</text>
        </description>
      </leaf>
      <leaf name="resume-interval">
        <type name="uint32">
          <range value="60..1800"/>
        </type>
        <units name="s"/>
        <default value="60"/>
        <description>
          <text>The interval for restoring the CP-CAR value from the extremely low threshold (1%) to minimum adjustable threshold.</text>
        </description>
      </leaf>
    </container>
    <container name="adjust-user-type">
      <description>
        <text>Configure the user type for adjusting the user access rate based on the system status.</text>
      </description>
      <leaf name="dhcp">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable DHCP users.</text>
        </description>
      </leaf>
      <leaf name="pppoe">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable PPPoE users.</text>
        </description>
      </leaf>
      <leaf name="ipv4-trigger">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable IPv4 users.</text>
        </description>
      </leaf>
      <leaf name="ipv6-trigger">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable IPv6 users.</text>
        </description>
      </leaf>
      <leaf name="dot1x">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable 802.1x users.</text>
        </description>
      </leaf>
      <leaf name="l2tp">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable L2TP users.</text>
        </description>
      </leaf>
      <leaf name="dhcpv6">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable DHCPv6 users.</text>
        </description>
      </leaf>
    </container>
    <container name="adjust-switch">
      <description>
        <text>Configure the router to adjust the user access rate based on system status.</text>
      </description>
      <leaf name="enable">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable adjust the user access rate based on the system status.</text>
        </description>
      </leaf>
      <leaf name="strict-check">
        <when condition="../enable='true'"/>
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable strict check, which allows the router to check the usages of access-queue, ppp-cpcar-drop, ppp-send-queue, and ppp-receive-queue. The router decreases the user access rate if the usage of any of these parameters is high.</text>
        </description>
      </leaf>
      <leaf name="strict-check-l2tp">
        <type name="boolean"/>
        <default value="true"/>
        <description>
          <text>Enable/disable adjust the l2tp user access rate based on the system status.</text>
        </description>
      </leaf>
    </container>
    <container name="adjust-times">
      <description>
        <text>List of configure an interval at which the system status is detected for adjusting the user access rate and the minimum number of detection intervals after which the user access rate is increased.</text>
      </description>
      <list name="adjust-time">
        <ext:generated-by value="system"/>
        <ext:operation-exclude value="create"/>
        <key value="board-type"/>
        <description>
          <text>Configure an interval at which the system status is detected for adjusting the user access rate and the minimum number of detection intervals after which the user access rate is increased.</text>
        </description>
        <leaf name="board-type">
          <type name="board-type"/>
          <description>
            <text>The board type of the device.</text>
          </description>
        </leaf>
        <leaf name="adjust-interval">
          <type name="uint32">
            <range value="1..60"/>
          </type>
          <units name="s"/>
          <default value="1"/>
          <description>
            <text>Specifies the interval at which the system status is detected for adjusting the user access rate.</text>
          </description>
        </leaf>
        <leaf name="adjust-delay-count">
          <type name="uint32">
            <range value="1..300"/>
          </type>
          <ext:dynamic-default>
            <ext:default-value value="2">
              <when condition="../board-type = 'mpu-or-sru'"/>
              <description>
                <text>The default value is 2 when board-type is mpu-or-sru.</text>
              </description>
            </ext:default-value>
            <ext:default-value value="1">
              <when condition="../board-type = 'lpu'"/>
              <description>
                <text>The default value is 1 when board-type is LPU.</text>
              </description>
            </ext:default-value>
          </ext:dynamic-default>
          <description>
            <text>Specifies the minimum number of detection intervals after which the user access rate is increased.</text>
          </description>
        </leaf>
      </list>
    </container>
    <container name="radius-proxy-active-session">
      <must condition="restrain-threshold &gt; resume-threshold"/>
      <description>
        <text>Configure the acctive session for the threshold for restoring the user access rate.</text>
      </description>
      <leaf name="restrain-threshold">
        <type name="uint32">
          <range value="10..1000"/>
        </type>
        <default value="250"/>
        <description>
          <text>Specify the suppresion threshold.</text>
        </description>
      </leaf>
      <leaf name="resume-threshold">
        <type name="uint32">
          <range value="10..1000"/>
        </type>
        <default value="200"/>
        <description>
          <text>Specify the restoration threshold.</text>
        </description>
      </leaf>
    </container>
  </augment>
</module>
