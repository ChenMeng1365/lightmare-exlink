<?xml version="1.0" encoding="UTF-8"?>
<module name="huawei-ifit-common"
        xmlns="urn:ietf:params:xml:ns:yang:yin:1"
        xmlns:ifit-common="urn:huawei:yang:huawei-ifit-common"
        xmlns:ifit="urn:huawei:yang:huawei-ifit"
        xmlns:ext="urn:huawei:yang:huawei-extension"
        xmlns:inet="urn:ietf:params:xml:ns:yang:ietf-inet-types"
        xmlns:ifm="urn:huawei:yang:huawei-ifm"
        xmlns:ni="urn:huawei:yang:huawei-network-instance"
        xmlns:l3vpn="urn:huawei:yang:huawei-l3vpn">
  <yang-version value="1"/>
  <namespace uri="urn:huawei:yang:huawei-ifit-common"/>
  <prefix value="ifit-common"/>
  <import module="huawei-ifit">
    <prefix value="ifit"/>
  </import>
  <import module="huawei-extension">
    <prefix value="ext"/>
  </import>
  <import module="ietf-inet-types">
    <prefix value="inet"/>
  </import>
  <import module="huawei-ifm">
    <prefix value="ifm"/>
  </import>
  <import module="huawei-network-instance">
    <prefix value="ni"/>
  </import>
  <import module="huawei-l3vpn">
    <prefix value="l3vpn"/>
  </import>
  <organization>
    <text>Huawei Technologies Co., Ltd.</text>
  </organization>
  <contact>
    <text>Huawei Industrial Base
Bantian, Longgang
Shenzhen 518129
People's Republic of China
Website: http://www.huawei.com
Email: support@huawei.com</text>
  </contact>
  <description>
    <text>This module contains a collection of YANG definitions IFIT feature.</text>
  </description>
  <revision date="2020-04-08">
    <description>
      <text>Initial revision.</text>
    </description>
    <reference>
      <text>Huawei private.</text>
    </reference>
  </revision>
  <ext:task-name value="ifit"/>
  <typedef name="flow-type">
    <type name="enumeration">
      <enum name="unidirection">
        <value value="2"/>
        <description>
          <text>An unidirection IFIT flow.</text>
        </description>
      </enum>
      <enum name="bidirection">
        <value value="1"/>
        <description>
          <text>A bidirection IFIT flow.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Flow type.</text>
    </description>
  </typedef>
  <typedef name="measure-mode">
    <type name="enumeration">
      <enum name="e2e">
        <value value="1"/>
        <description>
          <text>E2E measure mode.</text>
        </description>
      </enum>
      <enum name="trace">
        <value value="2"/>
        <description>
          <text>Trace measure mode.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Measure mode.</text>
    </description>
  </typedef>
  <typedef name="flow-direction">
    <type name="enumeration">
      <enum name="ingress">
        <value value="1"/>
        <description>
          <text>Ingress of an IFIT flow.</text>
        </description>
      </enum>
      <enum name="transit-input">
        <value value="2"/>
        <description>
          <text>Transit input of an IFIT flow.</text>
        </description>
      </enum>
      <enum name="transit-output">
        <value value="3"/>
        <description>
          <text>Transit output of an IFIT flow.</text>
        </description>
      </enum>
      <enum name="egress">
        <value value="4"/>
        <description>
          <text>Egress of an IFIT flow.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Flow direction.</text>
    </description>
  </typedef>
  <typedef name="addr-family-type">
    <type name="enumeration">
      <enum name="ipv4-unicast">
        <value value="1"/>
        <description>
          <text>IPv4 unicast.</text>
        </description>
      </enum>
      <enum name="ipv6-unicast">
        <value value="2"/>
        <description>
          <text>IPv6 unicast.</text>
        </description>
      </enum>
    </type>
    <description>
      <text>Address family.</text>
    </description>
  </typedef>
  <rpc name="reset-dynamic-flow-all">
    <description>
      <text>Clear all dynamic IFIT flow.</text>
    </description>
    <ext:node-ref value="/ifit:ifit/ifit-common:ifit-common/ifit-common:dynamic-flow-hops"/>
    <input>
      <leaf name="all-flow">
        <type name="boolean"/>
        <mandatory value="true"/>
        <description>
          <text>Clear all dynamic IFIT flow.</text>
        </description>
      </leaf>
    </input>
  </rpc>
  <rpc name="reset-dynamic-flowid">
    <description>
      <text>Clear specified dynamic IFIT ID.</text>
    </description>
    <ext:node-ref value="/ifit:ifit/ifit-common:ifit-common/ifit-common:dynamic-flow-hops/ifit-common:dynamic-flow-hop"/>
    <input>
      <leaf name="flow-id">
        <type name="uint64"/>
        <mandatory value="true"/>
        <description>
          <text>Clear specified dynamic IFIT ID.</text>
        </description>
      </leaf>
    </input>
  </rpc>
  <augment target-node="/ifit:ifit">
    <description>
      <text>IFIT augment.</text>
    </description>
    <container name="ifit-common">
      <description>
        <text>Configure IFIT function.</text>
      </description>
      <container name="global">
        <description>
          <text>Configure global parameter of IFIT.</text>
        </description>
        <leaf name="node-id">
          <ext:operation-exclude value="update">
            <when condition="../../static-instances/static-instance"/>
            <description>
              <text>The 'node-id' cannot be updated, when static-instance exists.</text>
            </description>
          </ext:operation-exclude>
          <type name="uint32">
            <range value="1..1048575"/>
          </type>
          <description>
            <text>Node ID of IFIT.</text>
          </description>
        </leaf>
        <leaf name="dynamic-flow-aging-multiplier">
          <type name="uint16">
            <range value="2..100"/>
          </type>
          <description>
            <text>Multiplier of an dynamic IFIT flow age interval. If the instance interval calculation result is less than 10 minutes, the 10 minutes shall prevail.</text>
          </description>
        </leaf>
      </container>
      <container name="next-hops">
        <description>
          <text>List of IFIT function for the next hop addresses.</text>
        </description>
        <list name="next-hop">
          <key value="address"/>
          <description>
            <text>Configure IFIT function for the next hop address.</text>
          </description>
          <leaf name="address">
            <type name="inet:ip-address-no-zone"/>
            <description>
              <text>Next hop address.</text>
            </description>
          </leaf>
        </list>
      </container>
      <container name="peer-locators">
        <description>
          <text>List of IFIT function for the next locator addresses.</text>
        </description>
        <list name="peer-locator">
          <key value="prefix"/>
          <description>
            <text>Configure IFIT function for the next locator address.</text>
          </description>
          <leaf name="prefix">
            <type name="inet:ipv6-address-no-zone"/>
            <description>
              <text>Next locator address.</text>
            </description>
          </leaf>
          <leaf name="prefix-mask-length">
            <ext:operation-exclude value="update"/>
            <type name="uint32">
              <range value="32..120"/>
            </type>
            <mandatory value="true"/>
            <description>
              <text>Mask length of a next locator address.</text>
            </description>
          </leaf>
        </list>
      </container>
      <container name="static-instances">
        <description>
          <text>List of static instances of IFIT.</text>
        </description>
        <list name="static-instance">
          <key value="name"/>
          <unique tag="flow/flow-filter/filter-condition1/source-ip flow/flow-filter/filter-condition1/destination-ip flow/flow-filter/filter-condition1/source-mask flow/flow-filter/filter-condition1/destination-mask flow/flow-filter/filter-condition1/protocol flow/flow-filter/filter-condition1/source-port flow/flow-filter/filter-condition1/destination-port flow/flow-filter/filter-condition1/ni-name flow/flow-filter/filter-condition1/dscp"/>
          <unique tag="flow/flow-filter/filter-condition2/address-type flow/flow-filter/filter-condition2/peer-ni-name flow/flow-filter/filter-condition2/peer-filter/ip-condition/peer-ip"/>
          <description>
            <text>Configure static instance of IFIT.</text>
          </description>
          <leaf name="name">
            <type name="string">
              <length value="1..31"/>
            </type>
            <must condition="(../../../global/node-id)"/>
            <description>
              <text>Instance name of IFIT.</text>
            </description>
          </leaf>
          <leaf name="interval">
            <type name="uint16">
              <range value="10|30|60|300"/>
            </type>
            <units name="s"/>
            <default value="30"/>
            <description>
              <text>Interval of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="measure-mode">
            <type name="ifit-common:measure-mode"/>
            <default value="e2e"/>
            <description>
              <text>Measure mode of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="loss-measure-enable">
            <type name="boolean"/>
            <default value="true"/>
            <description>
              <text>Enable/disable loss measure function of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="delay-measure-enable">
            <type name="boolean"/>
            <default value="true"/>
            <description>
              <text>Enable/disable delay measure function of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="disorder-measure-enable">
            <type name="boolean"/>
            <default value="false"/>
            <description>
              <text>Enable/disable disorder measure function of an IFIT flow.</text>
            </description>
          </leaf>
          <container name="flow">
            <presence value="Enable flow"/>
            <description>
              <text>Configure IFIT flow.</text>
            </description>
            <leaf name="flow-type">
              <ext:operation-exclude value="update"/>
              <type name="ifit-common:flow-type"/>
              <mandatory value="true"/>
              <description>
                <text>Flow type of an IFIT flow.</text>
              </description>
            </leaf>
            <choice name="flow-filter">
              <mandatory value="true"/>
              <description>
                <text>Configure the filter of a flow.</text>
              </description>
              <case name="filter-condition1">
                <description>
                  <text>Filter condition 1.</text>
                </description>
                <leaf name="source-ip">
                  <ext:operation-exclude value="update"/>
                  <type name="inet:ip-address-no-zone"/>
                  <mandatory value="true"/>
                  <description>
                    <text>Source IP address of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="destination-ip">
                  <ext:operation-exclude value="update"/>
                  <type name="inet:ip-address-no-zone"/>
                  <must condition="../destination-ip != ../source-ip"/>
                  <mandatory value="true"/>
                  <description>
                    <text>Destination IP address of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="source-mask">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint8">
                    <range value="1..32"/>
                  </type>
                  <default value="32"/>
                  <description>
                    <text>Source IP address mask of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="destination-mask">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint8">
                    <range value="1..32"/>
                  </type>
                  <default value="32"/>
                  <description>
                    <text>Destination IP address mask of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="protocol">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint8">
                    <range value="0..254"/>
                    <ext:value-meaning>
                      <ext:item value="6">
                        <ext:meaning value="tcp"/>
                      </ext:item>
                      <ext:item value="17">
                        <ext:meaning value="udp"/>
                      </ext:item>
                      <ext:item value="132">
                        <ext:meaning value="sctp"/>
                      </ext:item>
                    </ext:value-meaning>
                  </type>
                  <description>
                    <text>Protocol of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="source-port">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint16">
                    <range value="1..65535"/>
                  </type>
                  <must condition="../protocol=6 or ../protocol=17 or ../protocol=132"/>
                  <description>
                    <text>Source port of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="destination-port">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint16">
                    <range value="1..65535"/>
                  </type>
                  <must condition="../protocol =6 or ../protocol=17 or ../protocol=132"/>
                  <description>
                    <text>Destination port of an IFIT flow.</text>
                  </description>
                </leaf>
                <leaf name="ni-name">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="leafref">
                    <path value="/ni:network-instance/ni:instances/ni:instance/ni:name"/>
                  </type>
                  <must condition="../ni-name!='_public_' and /ni:network-instance/ni:instances/ni:instance[ni:name=current()]/l3vpn:afs/l3vpn:af[l3vpn:type='ipv4-unicast']"/>
                  <description>
                    <text>Name of the VPN to which an IFIT flow belongs.</text>
                  </description>
                </leaf>
                <leaf name="dscp">
                  <ext:operation-exclude value="update|delete"/>
                  <type name="uint16">
                    <range value="0..63"/>
                  </type>
                  <description>
                    <text>DSCP of an IFIT flow.</text>
                  </description>
                </leaf>
              </case>
              <case name="filter-condition2">
                <description>
                  <text>Filter condition 2.</text>
                </description>
                <leaf name="address-type">
                  <ext:operation-exclude value="update"/>
                  <type name="addr-family-type"/>
                  <mandatory value="true"/>
                  <description>
                    <text>Address type of an IFIT flow peer.</text>
                  </description>
                </leaf>
                <leaf name="peer-ni-name">
                  <ext:operation-exclude value="update"/>
                  <type name="leafref">
                    <path value="/ni:network-instance/ni:instances/ni:instance/ni:name"/>
                  </type>
                  <must condition=" ../peer-ni-name!='_public_' and /ni:network-instance/ni:instances/ni:instance[ni:name = current()]/l3vpn:afs/l3vpn:af[l3vpn:type=current()/../address-type]"/>
                  <mandatory value="true"/>
                  <description>
                    <text>Name of the VPN to which an IFIT flow peer belongs.</text>
                  </description>
                </leaf>
                <choice name="peer-filter">
                  <mandatory value="true"/>
                  <description>
                    <text>Configure the peer filter of a flow.</text>
                  </description>
                  <case name="ip-condition">
                    <description>
                      <text>Peer filter ip condition.</text>
                    </description>
                    <leaf name="peer-ip">
                      <ext:operation-exclude value="update"/>
                      <type name="inet:ipv4-address-no-zone"/>
                      <mandatory value="true"/>
                      <description>
                        <text>Peer IP address of an IFIT flow.</text>
                      </description>
                    </leaf>
                  </case>
                  <case name="locator-condition">
                    <description>
                      <text>Peer filter locatior condition.</text>
                    </description>
                    <leaf name="peer-locator-prefix">
                      <ext:operation-exclude value="update"/>
                      <type name="inet:ipv6-address-no-zone"/>
                      <mandatory value="true"/>
                      <description>
                        <text>Peer locator address.</text>
                      </description>
                    </leaf>
                    <leaf name="peer-locator-prefix-mask-len">
                      <ext:operation-exclude value="update"/>
                      <type name="uint32">
                        <range value="32..120"/>
                      </type>
                      <mandatory value="true"/>
                      <description>
                        <text>Mask length of a peer locator address.</text>
                      </description>
                    </leaf>
                  </case>
                </choice>
              </case>
            </choice>
            <container name="bind-ifs">
              <description>
                <text>List of flow specified interfaces of IFIT.</text>
              </description>
              <list name="bind-if">
                <key value="if-name"/>
                <description>
                  <text>Configure flow specified interface of IFIT.</text>
                </description>
                <leaf name="if-name">
                  <type name="leafref">
                    <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
                  </type>
                  <description>
                    <text>Interface name to which an IFIT flow binds.</text>
                  </description>
                </leaf>
                <leaf name="flow-id">
                  <type name="uint64"/>
                  <config value="false"/>
                  <description>
                    <text>Flow ID of an IFIT flow.</text>
                  </description>
                </leaf>
              </list>
            </container>
          </container>
        </list>
      </container>
      <container name="dynamic-flow-hops">
        <config value="false"/>
        <description>
          <text>List of dynamic flow hops of IFIT.</text>
        </description>
        <list name="dynamic-flow-hop">
          <key value="flow-id"/>
          <description>
            <text>Operational data of dynamic flow hop of IFIT.</text>
          </description>
          <leaf name="flow-id">
            <type name="uint64"/>
            <description>
              <text>Flow ID of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="flow-type">
            <type name="ifit-common:flow-type"/>
            <description>
              <text>Flow type of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="if-name">
            <type name="leafref">
              <path value="/ifm:ifm/ifm:interfaces/ifm:interface/ifm:name"/>
            </type>
            <description>
              <text>Interface name to which an IFIT flow passes.</text>
            </description>
          </leaf>
          <leaf name="interval">
            <type name="uint16">
              <range value="10|30|60|300"/>
            </type>
            <units name="s"/>
            <description>
              <text>Interval of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="direction">
            <type name="ifit-common:flow-direction"/>
            <description>
              <text>Direction of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="loss-measure-enable">
            <type name="boolean"/>
            <description>
              <text>Enable/disable loss measure function of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="delay-measure-enable">
            <type name="boolean"/>
            <description>
              <text>Enable/disable delay measure function of an IFIT flow.</text>
            </description>
          </leaf>
          <leaf name="disorder-measure-enable">
            <type name="boolean"/>
            <description>
              <text>Enable/disable disorder measure function of an IFIT flow.</text>
            </description>
          </leaf>
        </list>
      </container>
    </container>
  </augment>
</module>
